import {
  MainBackground,
  MainContainer,
  NavigateLink,
  Stroke,
  MainTitle,
  NavigateContainer,
  OptionIconContainer,
  OptionIcon,
  OptionContainer,
  MenuLink,
  MenuChoice,
  MenuContainer,
  MenuButton,
} from '../styles/js/header'
import { useTheme } from './contexts/ThemeContext'
import { useAuth } from './contexts/AuthContext'
import { removeToken } from '../services/token'
import { useEffect, useState } from 'react'
import { MESSAGE } from '../utils/constant'
import { toast } from 'react-toastify'

const Header = () => {
  const [isOpenMenu, setOpenMenu] = useState(false)
  const { isLogin, logout } = useAuth()
  const { theme, setTheme } = useTheme()

  const lightIcon = (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28">
      <path d="M13.9998 6.98698C10.1328 6.98698 6.98681 10.1336 6.98681 14.0006C6.98681 17.8677 10.1328 21.0143 13.9998 21.0143C17.8663 21.0143 21.0128 17.8683 21.0128 14.0006C21.0128 10.1329 17.8663 6.98698 13.9998 6.98698ZM13.9998 4.92542C13.637 4.92542 13.2891 4.78134 13.0325 4.52485C12.7759 4.26836 12.6316 3.92047 12.6314 3.55766V1.36838C12.6314 1.00546 12.7756 0.65741 13.0322 0.400789C13.2889 0.144168 13.6369 0 13.9998 0C14.3627 0 14.7108 0.144168 14.9674 0.400789C15.224 0.65741 15.3682 1.00546 15.3682 1.36838V3.55766C15.368 3.92047 15.2238 4.26836 14.9672 4.52485C14.7106 4.78134 14.3626 4.92542 13.9998 4.92542ZM13.9998 23.074C13.8201 23.074 13.6422 23.1094 13.4762 23.1781C13.3102 23.2469 13.1593 23.3477 13.0322 23.4747C12.9052 23.6018 12.8044 23.7527 12.7356 23.9187C12.6668 24.0847 12.6314 24.2626 12.6314 24.4423V26.631C12.6314 26.9939 12.7756 27.342 13.0322 27.5986C13.2889 27.8552 13.6369 27.9994 13.9998 27.9994C14.3627 27.9994 14.7108 27.8552 14.9674 27.5986C15.224 27.342 15.3682 26.9939 15.3682 26.631V24.4423C15.368 24.0795 15.2238 23.7315 14.9672 23.4749C14.7107 23.2183 14.3627 23.0741 13.9998 23.074ZM20.4158 7.58344C20.1593 7.32674 20.0153 6.97874 20.0153 6.6159C20.0153 6.25306 20.1593 5.90506 20.4158 5.64836L21.964 4.10018C22.0905 3.97094 22.2415 3.86808 22.4081 3.79755C22.5746 3.72702 22.7535 3.69022 22.9344 3.68928C23.1153 3.68833 23.2946 3.72327 23.4619 3.79206C23.6292 3.86085 23.7812 3.96213 23.9092 4.09005C24.0371 4.21796 24.1384 4.36997 24.2071 4.53727C24.2759 4.70458 24.3109 4.88387 24.3099 5.06476C24.309 5.24566 24.2722 5.42457 24.2017 5.59115C24.1311 5.75773 24.0283 5.90868 23.899 6.03525L22.3508 7.58344C22.0942 7.84003 21.7462 7.98417 21.3833 7.98417C21.0204 7.98417 20.6724 7.84003 20.4158 7.58344ZM7.58327 20.4172C7.45628 20.29 7.30547 20.1891 7.13945 20.1202C6.97343 20.0514 6.79546 20.0159 6.61573 20.0159C6.436 20.0159 6.25803 20.0514 6.09201 20.1202C5.92599 20.1891 5.77517 20.29 5.64819 20.4172L4.10001 21.9647C3.8478 22.2223 3.70738 22.5689 3.70926 22.9293C3.71114 23.2898 3.85516 23.6349 4.11003 23.8898C4.36491 24.1447 4.71005 24.2887 5.0705 24.2906C5.43094 24.2924 5.77757 24.152 6.03508 23.8998L7.58327 22.351C7.71035 22.2241 7.81117 22.0734 7.87996 21.9075C7.94875 21.7416 7.98415 21.5637 7.98415 21.3841C7.98415 21.2045 7.94875 21.0266 7.87996 20.8607C7.81117 20.6948 7.71035 20.5441 7.58327 20.4172ZM23.0738 14C23.0738 13.2442 23.6864 12.6316 24.4422 12.6316H26.6314C26.8136 12.6277 26.9946 12.6603 27.164 12.7273C27.3334 12.7943 27.4876 12.8944 27.6178 13.0219C27.748 13.1493 27.8514 13.3014 27.922 13.4693C27.9926 13.6372 28.029 13.8175 28.029 13.9997C28.029 14.1818 27.9926 14.3622 27.922 14.5301C27.8514 14.698 27.748 14.8501 27.6178 14.9775C27.4876 15.1049 27.3334 15.2051 27.164 15.2721C26.9946 15.3391 26.8136 15.3716 26.6314 15.3678H24.4422C24.2625 15.3678 24.0846 15.3325 23.9186 15.2638C23.7525 15.1951 23.6017 15.0944 23.4746 14.9674C23.3475 14.8404 23.2467 14.6895 23.178 14.5236C23.1092 14.3576 23.0738 14.1797 23.0738 14ZM4.92525 14C4.92525 13.8203 4.88986 13.6424 4.82109 13.4763C4.75232 13.3103 4.65153 13.1595 4.52446 13.0324C4.3974 12.9053 4.24655 12.8046 4.08053 12.7358C3.91451 12.667 3.73657 12.6316 3.55687 12.6316H1.36821C1.1861 12.6277 1.00505 12.6603 0.835675 12.7273C0.6663 12.7943 0.512008 12.8944 0.381845 13.0219C0.251682 13.1493 0.148269 13.3014 0.0776694 13.4693C0.0070693 13.6372 -0.0292969 13.8175 -0.0292969 13.9997C-0.0292969 14.1818 0.0070693 14.3622 0.0776694 14.5301C0.148269 14.698 0.251682 14.8501 0.381845 14.9775C0.512008 15.1049 0.6663 15.2051 0.835675 15.2721C1.00505 15.3391 1.1861 15.3716 1.36821 15.3678H3.55749C3.92024 15.3678 4.26814 15.2237 4.52464 14.9672C4.78115 14.7106 4.92525 14.3628 4.92525 14ZM20.4158 20.4172C20.6725 20.1607 21.0205 20.0167 21.3833 20.0167C21.7461 20.0167 22.0941 20.1607 22.3508 20.4172L23.899 21.9654C24.1556 22.222 24.2996 22.57 24.2996 22.9328C24.2995 23.2957 24.1553 23.6436 23.8987 23.9001C23.7717 24.0272 23.6208 24.1279 23.4548 24.1966C23.2888 24.2654 23.1109 24.3007 22.9313 24.3007C22.5684 24.3006 22.2205 24.1564 21.964 23.8998L20.4158 22.3516C20.2887 22.2247 20.1878 22.0739 20.119 21.9079C20.0502 21.742 20.0148 21.5641 20.0148 21.3844C20.0148 21.2048 20.0502 21.0269 20.119 20.8609C20.1878 20.6949 20.2887 20.5442 20.4158 20.4172ZM7.58327 7.58344C7.83985 7.32682 7.984 6.97879 7.984 6.6159C7.984 6.25301 7.83985 5.90498 7.58327 5.64836L6.03508 4.1008C5.77678 3.8529 5.43162 3.71611 5.07363 3.71976C4.71564 3.72341 4.37333 3.86721 4.12014 4.12032C3.86695 4.37343 3.72304 4.71569 3.71927 5.07368C3.71551 5.43167 3.85219 5.77687 4.10001 6.03525L5.64819 7.58344C5.77517 7.71063 5.92599 7.81155 6.09201 7.8804C6.25803 7.94925 6.436 7.98469 6.61573 7.98469C6.79546 7.98469 6.97343 7.94925 7.13945 7.8804C7.30547 7.81155 7.45628 7.71063 7.58327 7.58344Z" />
    </svg>
  )

  const darkIcon = (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28">
      <path d="M27.3186 15.9471C27.0322 15.8755 26.7458 15.9471 26.4951 16.1261C25.5642 16.9138 24.4901 17.5583 23.3086 17.9879C22.1986 18.4176 20.9813 18.6324 19.6923 18.6324C16.7922 18.6324 14.1427 17.4509 12.2451 15.5532C10.3474 13.6556 9.16589 11.0061 9.16589 8.10594C9.16589 6.8886 9.38071 5.70706 9.73876 4.63293C10.1326 3.48719 10.7055 2.44887 11.4574 1.55376C11.7796 1.15992 11.708 0.58705 11.3141 0.264812C11.0635 0.0857902 10.7771 0.0141817 10.4906 0.0857902C7.44728 0.909288 4.79777 2.7353 2.90014 5.16999C1.07413 7.56888 0 10.5406 0 13.763C0 17.6657 1.57539 21.2103 4.15329 23.7882C6.7312 26.3661 10.24 27.9415 14.1785 27.9415C17.4725 27.9415 20.5158 26.7958 22.9505 24.8981C25.421 22.9647 27.2112 20.2078 27.9631 17.057C28.1063 16.5557 27.8199 16.0545 27.3186 15.9471Z" />
    </svg>
  )

  const optionIcon = (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 22">
      <path d="M26.25 21.5001H1.75001C0.783473 21.5001 0 20.7165 0 19.7501C0 18.7836 0.783473 18.0001 1.75001 18.0001H26.25C27.2165 18.0001 28.0001 18.7836 28.0001 19.7501C28 20.7165 27.2165 21.5001 26.25 21.5001ZM26.25 12.75H1.75001C0.783473 12.75 0 11.9665 0 11.0001C0 10.0336 0.783473 9.25006 1.75001 9.25006H26.25C27.2165 9.25006 28.0001 10.0335 28.0001 11.0001C28.0001 11.9666 27.2165 12.75 26.25 12.75ZM26.25 4.00002H1.75001C0.783473 4.00002 0 3.21655 0 2.25001C0 1.28347 0.783473 0.5 1.75001 0.5H26.25C27.2165 0.5 28.0001 1.28347 28.0001 2.25001C28.0001 3.21655 27.2165 4.00002 26.25 4.00002Z" />
    </svg>
  )

  const currentTheme = theme === 'light' ? lightIcon : darkIcon

  const handleTheme = () => {
    setTheme(theme === 'light' ? 'dark' : 'light')
  }

  const handleMenu = () => {
    setOpenMenu(!isOpenMenu)
  }

  const handleLogout = () => {
    handleMenu()
    removeToken()
    logout()
    toast.success(MESSAGE.LOGOUT_SUCCESS)
  }

  useEffect(() => {
    localStorage.setItem('theme', theme)
  }, [theme])

  const option = (
    <OptionContainer>
      <OptionIconContainer onClick={handleTheme}>
        <OptionIcon>{currentTheme}</OptionIcon>
      </OptionIconContainer>
      <OptionIconContainer
        className={isOpenMenu ? 'hold' : ''}
        onClick={handleMenu}
      >
        <OptionIcon>{optionIcon}</OptionIcon>
      </OptionIconContainer>
    </OptionContainer>
  )

  const navigate = (
    <NavigateContainer>
      <NavigateLink to="/register" className="yellow">
        Đăng ký
      </NavigateLink>
      <NavigateLink to="/login" className="gray">
        Đăng nhập
      </NavigateLink>
    </NavigateContainer>
  )

  const menu = (
    <MenuContainer>
      <MenuChoice>
        <MenuLink to="/me" onClick={handleMenu}>
          Cá nhân
        </MenuLink>
        <Stroke />
      </MenuChoice>
      <MenuChoice>
        {/* Nếu tương lai có route /setting thì thêm onClick={handleMenu} */}
        <MenuLink to="/setting">Cài đặt</MenuLink>
        <Stroke />
      </MenuChoice>
      <MenuChoice>
        <MenuLink to="/donate">Ủng hộ</MenuLink>
        <Stroke />
      </MenuChoice>
      <MenuChoice>
        <MenuButton onClick={handleLogout}>Đăng xuất</MenuButton>
        <Stroke />
      </MenuChoice>
    </MenuContainer>
  )

  return (
    <MainContainer>
      <MainBackground>
        <MainTitle to="/">VAIR ZONE</MainTitle>
        {isLogin ? option : navigate}
      </MainBackground>
      <Stroke />
      {isOpenMenu ? menu : ''}
    </MainContainer>
  )
}

export default Header
